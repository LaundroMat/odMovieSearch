<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="main.css" rel="stylesheet">
    <script src="./js/typesense.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.7.3/dist/alpine.min.js" defer></script>
</head>

<body>
    <div class="container mx-auto">
        <div class="flex items-center justify-center h-screen">
            <div class="flex flex-col items-center">
                <div class="text-2xl">
                    Search for movies in <a href="https://www.reddit.com/r/opendirectories/"
                        target="_blank">r/opendirectories/</a>
                </div>
                <div class="mb-8 text-sm text-gray-400">
                    indexing since Dec 14, 2020
                </div>
                <div class="relative" x-data="search()" class="w-full" x-init="$watch('query', value => lookup(query))">
                    <div>
                        <input type=" text" x-on:focus="open=true" name="movieSearch"
                            class="w-full px-6 py-2 rounded-lg border border-1 border-gray-400" autofocus
                            placeholder="search by movie name" x-model="query" x-on="">
                        </input>
                    </div>
                    <div x-show.transition="open" x-on:click.away="open = false"
                        class="absolute top-0 mt-8 w-full px-6 py-2 rounded-b-lg shadow-lg z-10 bg-white border border-1 border-gray-400">
                        <template x-for="(hit, index) in result.hits" :key="index">
                            <!-- You can also reference "index" inside the iteration if you need. -->
                            <div class="flex flex-col">
                                <div>
                                    <a :href="hit.document.file_url" class="text-indigo-500 hover:text-indigo-800">
                                        <span x-text="hit.document.title">
                                        </span> (<span x-text="hit.document.year"></span>)
                                    </a>
                                </div>
                                <div class="flex gap-x-2">
                                    <div x-text="hit.document.imdb_rating"></div>
                                    <div x-text="hit.document.director"></div>
                                    <div x-text="hit.document.screen_size"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <div class="text-center text-sm text-gray-700 mb-2">
                        Help me cover the costs (ca. $15/month)
                    </div>
                    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js"
                        data-name="bmc-button" data-slug="St8NicmPr" data-color="#FFDD00" data-emoji=""
                        data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000"
                        data-font-color="#000000" data-coffee-color="#ffffff"></script>
                </div>
            </div>
        </div>
</body>

<script>
    var typesense_client = new Typesense.Client({
        'nodes': [{
            'host': 'lfvrjt370mk8x2e9p-1.a1.typesense.net',
            'port': '443',
            'protocol': 'https',
        }],
        'apiKey': 'ZZI2Rck5aGsqOb9EoaxlzaSPIiShMFd9',
        'connectionTimeoutSeconds': 2
    })

    function search() {
        return {
            query: '',
            result: {
                hits: []
            },
            open: false,
            lookup() {
                this.isLoading = true;
                this.open = true;
                var searchParameters = {
                    'q': this.query,
                    'query_by': 'title'
                }
                typesense_client.collections('movies').documents().search(searchParameters).then(data =>
                    this.result = data)
                this.isLoading = false
            },
        }
    }
</script>

</html>